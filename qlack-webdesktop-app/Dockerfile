FROM openjdk:8-jdk-alpine

ARG WEBDESKTOP_PORT

ARG DATABASE_ROOT_PASSWORD

ARG SPRING_PROFILES_ACTIVE

ARG SYSTEM_DEFAULT_LANGUAGE

ARG WEBDEKTOP_URL

ARG KEYCLOAK_AUTH_URL

ARG KEYCLOAK_CLIENT

ARG KEYCLOAK_CLIENT_SECRET

ARG LDAP_ENABLED

ARG LDAP_URL

ARG LDAP_BASEDN

ARG LDAP_MAPPING_UID

ARG LDAP_MAPPING_GID

ARG LDAP_ADMIN_UID

ARG LDAP_ADMIN_PASSWORD

ARG WEBDESKTOP_ADMIN

ARG APPS_URL

ENV WEBDESKTOP_PORT ${WEBDESKTOP_PORT}

ENV DATABASE_ROOT_PASSWORD ${DATABASE_ROOT_PASSWORD}

ENV SPRING_PROFILES_ACTIVE ${SPRING_PROFILES_ACTIVE}

ENV SYSTEM_DEFAULT_LANGUAGE ${SYSTEM_DEFAULT_LANGUAGE}

ENV WEBDESKTOP_URL ${WEBDESKTOP_URL}

ENV KEYCLOAK_AUTH_URL ${KEYCLOAK_AUTH_URL}

ENV KEYCLOAK_CLIENT ${KEYCLOAK_CLIENT}

ENV KEYCLOAK_CLIENT_SECRET ${KEYCLOAK_CLIENT_SECRET}

ENV LDAP_ENABLED ${LDAP_ENABLED}

ENV LDAP_URL ${LDAP_URL}

ENV LDAP_BASEDN ${LDAP_BASEDN}

ENV LDAP_MAPPING_UID ${LDAP_MAPPING_UID}

ENV LDAP_MAPPING_GID ${LDAP_MAPPING_GID}

ENV LDAP_ADMIN_UID ${LDAP_ADMIN_UID}

ENV LDAP_ADMIN_PASSWORD ${LDAP_ADMIN_PASSWORD}

ENV WEBDESKTOP_ADMIN ${WEBDESKTOP_ADMIN}

ENV APPS_URL ${APPS_URL}

COPY target/qlack-webdesktop-app.jar /opt/app/qlack-webdesktop-app.jar

COPY docker_deploy_webdesktop.sh /scripts/docker_deploy_webdesktop.sh

RUN dos2unix /scripts/docker_deploy_webdesktop.sh

RUN chmod +x /scripts/docker_deploy_webdesktop.sh

ENTRYPOINT ["/scripts/docker_deploy_webdesktop.sh"]